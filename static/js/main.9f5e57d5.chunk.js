(this.webpackJsonpctrl=this.webpackJsonpctrl||[]).push([[0],{29:function(t,e,i){},30:function(t,e,i){},36:function(t,e,i){"use strict";i.r(e);var n=i(8),o=i.n(n),s=i(23),c=i.n(s),a=(i(29),i(21)),r=(i(30),i(20)),h=i.n(r),u=i(24),l=i(17);l.a.initializeApp({apiKey:"AIzaSyAPqg2NsIay14jl3-kSwPUaVY65NoBQabY",authDomain:"ctrl-3990c.firebaseapp.com",projectId:"ctrl-3990c"});var d=l.a.firestore(),p=function(){var t=Object(u.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=d.batch(),t.next=3,d.collection("list").get();case 3:return t.sent.forEach((function(t){e.delete(t.ref)})),t.next=7,e.commit();case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),f=i(3),v={padding:30};function b(){var t=Object(n.useCallback)((function(t){var e,i;e=(new Date).getTime().toString(),i=t,d.collection("list").add({id:e,name:i})}),[]);return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{style:v,type:"button",onClick:function(){return t("up")},children:"Up"}),Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{style:v,type:"button",onClick:function(){return t("left")},children:"Left"}),Object(f.jsx)("button",{style:v,type:"button",onClick:function(){return t("down")},children:"Down"}),Object(f.jsx)("button",{style:v,type:"button",onClick:function(){return t("right")},children:"Right"})]})]})}var k,y=i(12),j=i(9),w=i(10),m=i(16),g=i(15),O=function t(e,i){var n=this;Object(j.a)(this,t),this.posX=e,this.posY=i,this.positionsEqual=function(t){return n.posX===t.posX&&n.posY===t.posY}};!function(t){t.LEFT="left",t.UP="up",t.RIGHT="right",t.DOWN="down"}(k||(k={}));var z=function(t){Object(m.a)(i,t);var e=Object(g.a)(i);function i(t,n,o){var s;return Object(j.a)(this,i),(s=e.call(this,t,n)).color=o,s}return i}(O),S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new O(0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.DOWN,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(j.a)(this,t),this._headPosition=e,this._size=i,this._direction=n,this._step=o,this.body=[],this.dead=!1,this.body.push(this.headPosition)}return Object(w.a)(t,[{key:"headPosition",get:function(){return this._headPosition},set:function(t){this.body.length>=this.size&&this.body.shift(),this.body.push(t),this._headPosition=t}},{key:"increaseSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._size=this.size+t}},{key:"size",get:function(){return this._size}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction===k.DOWN&&t===k.UP||this._direction===k.UP&&t===k.DOWN||this._direction===k.LEFT&&t===k.RIGHT||this._direction===k.RIGHT&&t===k.LEFT||(this._direction=t)}},{key:"nextPosition",value:function(t){switch(t){case k.UP:return new O(this.headPosition.posX,this.headPosition.posY-this._step);case k.DOWN:return new O(this.headPosition.posX,this.headPosition.posY+this._step);case k.LEFT:return new O(this.headPosition.posX-this._step,this.headPosition.posY);case k.RIGHT:return new O(this.headPosition.posX+this._step,this.headPosition.posY);default:return console.log("no action handler for key: ",t),this.headPosition}}},{key:"checkAnotherWorm",value:function(t,e){var i=this.approachedAnotherWorm(e,t);i&&(i.dead=!0,this.increaseSize(i.size))}},{key:"approachedAnotherWorm",value:function(t,e){return t.find((function(t){return!t.headPosition.positionsEqual(e)&&!t.dead&&t.body.some((function(t){return t.positionsEqual(e)}))}))}},{key:"checkHimself",value:function(t,e){return this.body.some((function(e){return e.positionsEqual(t)}))||this.pointIsInPoly(t,e)}},{key:"pointIsInPoly",value:function(t,e){var i=!1,n=Object(y.a)(this.body),o=Math.min.apply(Math,Object(y.a)(n.map((function(t){return t.posX})))),s=Math.min.apply(Math,Object(y.a)(n.map((function(t){return t.posY})))),c=Math.max.apply(Math,Object(y.a)(n.map((function(t){return t.posX})))),a=Math.max.apply(Math,Object(y.a)(n.map((function(t){return t.posY}))));if(0===o)for(var r=s;r<a;r++)n.push(new O(-1,r));if(0===s)for(var h=o;h<c;h++)n.push(new O(h,-1));if(c===e.width)for(var u=s;u<a;u++)n.push(new O(e.width+1,u));if(a===e.height)for(var l=o;l<c;l++)n.push(new O(l,e.height+1));if(t.posX<o||t.posX>c||t.posY<s||t.posY>a)return!1;for(var d=0,p=n.length-1;d<n.length;p=d++)n[d].posY>t.posY!==n[p].posY>t.posY&&t.posX<(n[p].posX-n[d].posX)*(t.posY-n[d].posY)/(n[p].posY-n[d].posY)+n[d].posX&&(i=!i);return i}}]),t}(),x=function(t){Object(m.a)(i,t);var e=Object(g.a)(i);function i(){return Object(j.a)(this,i),e.apply(this,arguments)}return Object(w.a)(i,null,[{key:"newRandomly",value:function(t,e){for(var i=e.getRandomPosition();t.some((function(t){return t.positionsEqual(i)}));)i=e.getRandomPosition();var n=i;return new this(n.posX,n.posY)}}]),i}(O),P=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0;Object(j.a)(this,t),this._blockSize=n,this.ctx=o,this.size={width:0,height:0},this.backgroundColor="#aab9b4",this.emptyBlockColor="#8a9b93",this.size={width:e,height:i}}return Object(w.a)(t,[{key:"getRandomPosition",value:function(){return new O(Math.floor(Math.random()*this.canvasSizeInBlocks.width),Math.floor(Math.random()*this.canvasSizeInBlocks.height))}},{key:"canvasSizeInBlocks",get:function(){return{width:Math.floor(this.size.width/this._blockSize),height:Math.floor(this.size.height/this._blockSize)}}},{key:"outOfCanvas",value:function(t){return this.canvasSizeInBlocks.height<=t.posY||t.posY<0||this.canvasSizeInBlocks.width<=t.posX||t.posX<0}},{key:"draw",value:function(t){this.ctx.clearRect(0,0,this.size.width,this.size.height),this.drawEmptyBlocks();for(var e=0;e<t.length;e++){var i=t[e];this.drawBlock(i)}}},{key:"drawEmptyBlocks",value:function(){for(var t=0;t<this.canvasSizeInBlocks.width;t++)for(var e=0;e<this.canvasSizeInBlocks.height;e++)this.drawBlock(new z(t,e,this.emptyBlockColor))}},{key:"drawBlock",value:function(t){this.ctx.fillStyle=t.color,this.ctx.fillRect(t.posX*this._blockSize,t.posY*this._blockSize,this._blockSize,this._blockSize),this.ctx.fillStyle=this.backgroundColor,this.ctx.fillRect(t.posX*this._blockSize+1,t.posY*this._blockSize+1,this._blockSize-2,this._blockSize-2),this.ctx.fillStyle=t.color,this.ctx.fillRect(t.posX*this._blockSize+2,t.posY*this._blockSize+2,this._blockSize-4,this._blockSize-4)}}]),t}(),_=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;Object(j.a)(this,t),this.fps=n,this.intervalId=void 0,this.tick=0,this.snacks=[],this.worm=void 0,this.canvas=void 0,this.extraDots=[],this.canvas=new P(i.width,i.height,i.blockSize,e),this.worm=new S(this.canvas.getRandomPosition()),this.initSnacks(1)}return Object(w.a)(t,[{key:"initSnacks",value:function(t){for(var e=0;e<t;e++)this.snacks.push(x.newRandomly(this.worm.body,this.canvas))}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.intervalId=setInterval((function(){t.run(e)}),1e3/this.fps)}},{key:"stop",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"run",value:function(t){this.tick++,this.move(this.worm,this.worm.direction)&&this.draw(),this.worm.dead&&this.stop()}},{key:"move",value:function(t,e){var i=t.nextPosition(e),n=this.checkNextMove(i,t);if(n){for(var o=0;o<this.snacks.length;o++)this.checkSnack(t,o,i);return t.headPosition=i,n}return n}},{key:"checkNextMove",value:function(t,e){return!this.canvas.outOfCanvas(t)&&!e.checkHimself(t,this.canvas.canvasSizeInBlocks)}},{key:"draw",value:function(){for(var t=[],e=0;e<this.worm.body.length;e++){var i=this.worm.body[e],n=this.worm.dead?"burlywood":"black";t.push(new z(i.posX,i.posY,n))}t.push(new z(this.worm.headPosition.posX,this.worm.headPosition.posY,"#965050"));for(var o=0;o<this.snacks.length;o++){var s=this.snacks[o];t.push(new z(s.posX,s.posY,"#447144"))}t.push.apply(t,Object(y.a)(this.extraDots.map((function(t){return new z(t.posX,t.posY,"blue")})))),this.canvas.draw(t)}},{key:"checkSnack",value:function(t,e,i){this.snacks[e].positionsEqual(i)&&(t.increaseSize(),this.snacks[e]=x.newRandomly(this.worm.body,this.canvas))}},{key:"handleKey",value:function(t){Object.values(k).includes(t)&&(this.worm.direction=t)}}]),t}();function Y(t){var e=t.canvasSize,i=Object(n.useRef)(),o=Object(n.useCallback)((function(t){if(t){var n=t.getContext("2d"),o=new _(n,e,50);i.current=o,o.start(!0)}}),[]);return Object(n.useEffect)((function(){var t,e=(t=function(t){var e;t.length&&(null===(e=i.current)||void 0===e||e.handleKey(t[0].name))},d.collection("list").orderBy("id","desc").onSnapshot((function(e){t(e.docs.map((function(t){return t.data()})))})));return function(){var t;e(),null===(t=i.current)||void 0===t||t.stop(),p()}}),[]),Object(f.jsx)("canvas",{ref:o,width:e.width,height:e.height,style:{border:"1px solid"}})}function I(){return Object(f.jsx)("div",{children:Object(f.jsx)(Y,{canvasSize:{width:500,height:500,blockSize:8}})})}var X=function(){var t=Object(n.useState)(!1),e=Object(a.a)(t,2),i=e[0],o=e[1];Object(n.useEffect)((function(){l.a.auth().signInAnonymously().then((function(t){o(!0)}))}));var s=Object(n.useState)(2),c=Object(a.a)(s,2),r=c[0],h=c[1],u=Object(n.useMemo)((function(){return 0===r?Object(f.jsx)(I,{}):1===r?Object(f.jsx)(b,{}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("h2",{children:"Choose mode:"}),Object(f.jsx)("button",{type:"button",onClick:function(){return h(0)},children:"Game"}),Object(f.jsx)("button",{type:"button",onClick:function(){return h(1)},children:"Controller"})]})}),[r]);return Object(f.jsx)("div",{className:"App",children:Object(f.jsxs)("header",{className:"App-header",children:[Object(f.jsx)("button",{type:"button",onClick:function(){return h(2)},children:"Back"}),i&&Object(f.jsx)(f.Fragment,{children:u})]})})},C=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,37)).then((function(e){var i=e.getCLS,n=e.getFID,o=e.getFCP,s=e.getLCP,c=e.getTTFB;i(t),n(t),o(t),s(t),c(t)}))};c.a.render(Object(f.jsx)(o.a.StrictMode,{children:Object(f.jsx)(X,{})}),document.getElementById("root")),C()}},[[36,1,2]]]);
//# sourceMappingURL=main.9f5e57d5.chunk.js.map